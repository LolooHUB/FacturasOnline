<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facturador Pro 2026</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --text: #1e293b; --card: #ffffff; --border: #e2e8f0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 10px; margin: 0; }
        .container { max-width: 850px; margin: 0 auto; }
        
        /* Est√©tica de tarjetas */
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 15px; }
        h3 { font-size: 0.8rem; text-transform: uppercase; color: #64748b; margin: 0 0 15px 0; border-bottom: 1px solid var(--border); padding-bottom: 5px; }
        
        input, textarea { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; box-sizing: border-box; font-size: 1rem; margin-bottom: 10px; background: #fff; color: #000; }
        textarea { height: 80px; resize: vertical; }

        /* Botones */
        .grid-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer; border: none; font-size: 0.9rem; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-mail { background: var(--primary); color: white; }
        .btn-wa { background: #22c55e; color: white; }
        .btn:active { transform: scale(0.98); }

        /* Preview de la factura (estilo AFIP simplificado) */
        #factura-preview { 
            background: white; color: black; width: 100%; border: 1px solid #000; padding: 15px; box-sizing: border-box; font-size: 0.8rem; 
        }
        .f-top { display: flex; border: 1px solid #000; margin-bottom: 10px; }
        .f-col { flex: 1; padding: 10px; }
        .f-letra { width: 45px; border-left: 1px solid #000; border-right: 1px solid #000; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; font-weight: bold; background: #eee; }
        .f-line { border: 1px solid #000; padding: 10px; border-top: none; }
        .f-total { border: 1px solid #000; border-top: none; padding: 10px; text-align: right; font-size: 1.4rem; font-weight: bold; }

        @media (max-width: 600px) {
            .f-top { flex-direction: column; }
            .f-letra { width: 100%; border: 1px solid #000; border-left: none; border-right: none; height: 40px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h3>üè¢ Mis Datos</h3>
        <input type="text" id="eNom" value="Aero 2000" placeholder="Nombre de tu negocio">
        <input type="text" id="eCuit" value="30-12345678-9" placeholder="Tu CUIT">
        <input type="text" id="ePago" value="ALIAS.MP.PAGO" placeholder="CBU o Alias para cobrar">
    </div>

    <div class="card">
        <h3>üë§ Cliente y Venta</h3>
        <input type="text" id="cNom" placeholder="Nombre del Cliente" oninput="upd()">
        <textarea id="det" placeholder="Detalle del servicio o producto..." oninput="upd()"></textarea>
        <input type="number" id="monto" placeholder="Monto Total $" oninput="upd()">
        <input type="email" id="email" placeholder="Email del cliente">
        <input type="tel" id="tel" placeholder="WhatsApp (Ej: 54911...)">

        <div class="grid-btns">
            <button onclick="enviar('mail')" class="btn btn-mail" id="btnM">üìß Enviar Mail</button>
            <button onclick="enviar('wa')" class="btn btn-wa">üü¢ WhatsApp</button>
        </div>
    </div>

    <div id="factura-preview">
        <div class="f-top">
            <div class="f-col"><strong id="p-eNom">AERO 2000</strong><br>CUIT: <span id="p-eCuit">...</span></div>
            <div class="f-letra">C</div>
            <div class="f-col" style="text-align: right;"><strong>FACTURA</strong><br>Fecha: <span id="p-fec"></span></div>
        </div>
        <div class="f-line">
            <strong>Cliente:</strong> <span id="p-cNom">...</span>
        </div>
        <div class="f-line" style="min-height: 80px;">
            <strong>Concepto:</strong><br><span id="p-det">...</span>
        </div>
        <div class="f-total">TOTAL: <span id="p-tot">$ 0.00</span></div>
    </div>
</div>

<script>
    emailjs.init("ne2_1nbxGq2hC0ju1"); // Tu Public Key

    function upd() {
        document.getElementById('p-eNom').innerText = document.getElementById('eNom').value.toUpperCase();
        document.getElementById('p-eCuit').innerText = document.getElementById('eCuit').value;
        document.getElementById('p-cNom').innerText = document.getElementById('cNom').value.toUpperCase() || "...";
        document.getElementById('p-det').innerText = document.getElementById('det').value || "...";
        document.getElementById('p-tot').innerText = "$ " + (document.getElementById('monto').value || "0.00");
        document.getElementById('p-fec').innerText = new Date().toLocaleDateString();
    }

    async function enviar(canal) {
        const cliente = document.getElementById('cNom').value || "Cliente";
        const monto = document.getElementById('monto').value || "0";
        const concepto = document.getElementById('det').value || "Servicios";
        const pago = document.getElementById('ePago').value;
        const emisor = document.getElementById('eNom').value;

        // 1. Generar y bajar PDF (Siempre)
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        pdf.setFontSize(22); pdf.text("FACTURA", 105, 20, {align:'center'});
        pdf.setFontSize(12);
        pdf.text(`Emisor: ${emisor}`, 20, 40);
        pdf.text(`Cliente: ${cliente}`, 20, 50);
        pdf.text(`Fecha: ${new Date().toLocaleDateString()}`, 20, 60);
        pdf.text("--------------------------------------------------", 20, 70);
        pdf.text(`Concepto: ${concepto}`, 20, 80);
        pdf.setFontSize(16);
        pdf.text(`TOTAL A PAGAR: $${monto}`, 20, 100);
        pdf.setFontSize(10);
        pdf.text(`Pagar a: ${pago}`, 20, 115);
        pdf.save(`Factura_${cliente}.pdf`);

        if (canal === 'mail') {
            const mailDestino = document.getElementById('email').value;
            if(!mailDestino) return alert("Falta el email del cliente");
            
            const btn = document.getElementById('btnM');
            btn.innerText = "Enviando...";
            btn.disabled = true;

            // Enviar v√≠a EmailJS (Cuerpo de mail HTML - Gratis)
            emailjs.send("service_t5t4wor", "template_vyjg8af", {
                to_email: mailDestino,
                to_name: cliente,
                emisor_name: emisor,
                total_monto: monto,
                detalle_venta: concepto,
                pago_alias: pago,
                fecha_comprobante: new Date().toLocaleDateString()
            }).then(() => {
                alert("¬°Mail enviado con el detalle!");
            }).catch((err) => {
                alert("Error al enviar el mail.");
                console.error(err);
            }).finally(() => {
                btn.innerText = "üìß Enviar Mail";
                btn.disabled = false;
            });

        } else {
            // WhatsApp con texto enriquecido
            const tel = document.getElementById('tel').value;
            if(!tel) return alert("Falta el n√∫mero de WhatsApp");
            const txt = `*NUEVA FACTURA*%0A` +
                        `*De:* ${emisor}%0A` +
                        `*Cliente:* ${cliente}%0A` +
                        `*Concepto:* ${concepto}%0A` +
                        `*TOTAL:* $${monto}%0A` +
                        `*Pagar a:* ${pago}%0A%0A` +
                        `_El PDF se descarg√≥ autom√°ticamente en mi dispositivo para adjuntarlo._`;
            window.open(`https://api.whatsapp.com/send?phone=${tel}&text=${txt}`, '_blank');
        }
    }
    window.onload = upd;
</script>
</body>
</html>
